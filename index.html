<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>國家能源全方位分析 - 總體概況 v20.6</title>
    <!-- 
      /* --- SYSTEM VERSION: v20.6 (Folder-Ready & Preview Pro) --- */
      1. 連結：導航欄 href 全數改為同層級相對路徑，確保在資料夾內點擊順暢。
      2. 穩定：延續 DOMContentLoaded + setTimeout(400ms) 渲染機制，保障 Canvas 預覽成功。
      3. 數據：100% 同步「發電量.json」實績，呈現 2024 能源轉型黃金交叉點。
      4. 視覺：修正圓餅圖 Formatter，確保滑動時 GW/億度 標籤穩定不變。
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap');
        
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #f8fafc; 
            color: #1e293b;
            margin: 0;
            overflow: hidden;
        }

        /* 導航美化 */
        .sidebar { background: #ffffff; }
        .nav-link { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            padding: 0.9rem 1.25rem; 
            border-radius: 0.75rem; 
            color: #64748b; 
            font-weight: 700; 
            transition: all 0.2s ease;
            text-decoration: none;
        }
        .nav-link:hover { background-color: #f1f5f9; color: #1e293b; }
        .nav-link.active { 
            background-color: #eff6ff; 
            color: #2563eb; 
            box-shadow: inset 0 0 0 1px rgba(37,99,235,0.08);
            border-left: 4px solid #2563eb;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }

        /* KPI 卡片 */
        .kpi-card { 
            background: white; 
            border-radius: 1.5rem; 
            border: 1px solid #e2e8f0; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            min-width: 0;
            border-bottom-width: 4px;
        }
        .kpi-card:hover { transform: translateY(-5px); }
        .kpi-value {
            font-size: clamp(1.25rem, 2vw, 1.875rem);
            font-weight: 900;
            line-height: 1;
        }

        .main-content { 
            flex: 1;
            height: 100vh;
            overflow-y: auto; 
            scroll-behavior: smooth; 
            padding-bottom: 8rem;
        }

        .chart-card { 
            background: white; 
            border-radius: 1.5rem; 
            border: 1px solid #e2e8f0; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.02);
            overflow: visible !important;
        }

        .main-content::-webkit-scrollbar { width: 5px; }
        .main-content::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        #loader {
            position: fixed;
            inset: 0;
            background: white;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }
    </style>
</head>
<body class="flex">

    <!-- 載入中遮罩 -->
    <div id="loader">
        <div class="flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-sm font-bold text-slate-500 animate-pulse">核心數據同步中...</p>
        </div>
    </div>

        <!-- 主內容區 -->
    <main class="main-content p-8 md:p-12">
        <div class="max-w-[1400px] mx-auto space-y-12">
            
            <header class="flex flex-col lg:flex-row lg:items-end justify-between gap-6">
                <div>
                    <h2 class="text-3xl md:text-4xl font-black tracking-tight text-slate-900 uppercase">國家能源總體概況</h2>
                    <p class="text-slate-500 mt-2 font-medium italic text-sm">數據點：114年 10月最新公告。來源：國家能源數據中心。</p>
                </div>
                <div class="flex items-center gap-3 bg-white border border-slate-200 px-4 py-2.5 rounded-xl shadow-sm">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                    </span>
                    <span class="text-xs font-black text-slate-600 uppercase tracking-tighter">系統狀態：資料夾部署就緒</span>
                </div>
            </header>

            <!-- KPI Grid -->
            <div id="kpi-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6"></div>

            <!-- Donut Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <div class="chart-card p-8"><div id="capacity-donut"></div></div>
                <div class="chart-card p-8"><div id="generation-donut"></div></div>
            </div>

            <!-- Evolution Chart -->
            <div class="chart-card p-10">
                <h3 class="text-xl font-black text-slate-800 mb-8 flex items-center gap-3">
                    <i data-lucide="trending-up" class="w-6 h-6 text-blue-600"></i> 我國能源發電占比變化 (2016-2024)
                </h3>
                <div id="evolution-area"></div>
                <div class="mt-6 text-[11px] text-slate-400 italic">註：2024 年燃氣 (42.4%) 已超越燃煤 (39.3%)。資料來源：能源署實績。</div>
            </div>
        </div>
    </main>

    <script>
        const THEME = { coal: '#334155', gas: '#0ea5e9', oil: '#854d0e', re: '#22c55e', nuke: '#ef4444', pumped: '#1d4ed8', storage: '#d946ef' };

        function renderKPIs() {
            const data = [
                { title: "全國總發電裝置容量", value: "69.2", unit: "GW", icon: "factory", border: "border-blue-500", bg: "bg-blue-50", text: "text-blue-600" },
                { title: "114年 累計發電量", value: "242.2", unit: "億度", icon: "zap", border: "border-emerald-500", bg: "bg-emerald-50", text: "text-emerald-600" },
                { title: "114年 綠能產出占比", value: "11.9", unit: "%", icon: "sun", border: "border-amber-500", bg: "bg-amber-50", text: "text-amber-600" },
                { title: "系統調節容量", value: "3.4", unit: "GW", icon: "battery-charging", border: "border-purple-500", bg: "bg-purple-50", text: "text-purple-600" }
            ];
            const grid = document.getElementById('kpi-grid');
            if (grid) {
                grid.innerHTML = data.map(d => `
                    <div class="kpi-card p-6 ${d.border} flex items-center gap-5">
                        <div class="w-14 h-14 flex-shrink-0 flex items-center justify-center rounded-2xl ${d.bg} ${d.text}"><i data-lucide="${d.icon}" class="w-7 h-7"></i></div>
                        <div class="min-w-0">
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1 truncate">${d.title}</p>
                            <div class="flex items-baseline gap-1"><span class="kpi-value text-slate-900">${d.value}</span><span class="text-[11px] font-bold text-slate-400">${d.unit}</span></div>
                        </div>
                    </div>
                `).join('');
                if (typeof lucide !== 'undefined') lucide.createIcons();
            }
        }

        const getDonutCfg = (title, series, labels, unit) => ({
            series, labels, 
            chart: { type: 'donut', height: 420, animations: { enabled: true, speed: 800 }, fontFamily: 'Noto Sans TC' },
            colors: [THEME.coal, THEME.gas, THEME.oil, THEME.re, THEME.nuke, THEME.pumped, THEME.storage],
            title: { text: title, align: 'center', margin: 15, style: { fontSize: '20px', fontWeight: 900 } },
            plotOptions: { 
                pie: { 
                    donut: { 
                        size: '72%', 
                        labels: { 
                            show: true, 
                            value: { show: true, fontSize: '24px', fontWeight: 900, offsetY: 5, formatter: (val) => val + " " + unit },
                            total: { show: true, label: '最新實績', fontWeight: 700, fontSize: '12px', color: '#94a3b8', formatter: (w) => w.globals.seriesTotals.reduce((a, b) => a + b, 0).toFixed(1) + " " + unit }
                        } 
                    } 
                } 
            },
            tooltip: { y: { formatter: (val) => val + " " + unit } },
            legend: { position: 'bottom', fontSize: '13px', fontWeight: 600, markers: { radius: 12 } },
            dataLabels: { enabled: true, style: { fontSize: '11px', fontWeight: 800 }, formatter: (v) => v.toFixed(0) + "%" }
        });

        // 核心啟動邏輯：解決 Canvas 預覽失效
        document.addEventListener("DOMContentLoaded", function() {
            renderKPIs();
            setTimeout(() => {
                try {
                    new ApexCharts(document.querySelector("#capacity-donut"), getDonutCfg("全國發電裝置容量分布 (GW)", [19.8, 22.5, 1.2, 22.3, 0.0, 2.6, 0.8], ['燃煤','燃氣','燃油','再生能源','核能','抽蓄','儲能'], 'GW')).render();
                    new ApexCharts(document.querySelector("#generation-donut"), getDonutCfg("累計發電量結構分布 (億度)", [7.8, 11.5, 0.5, 2.9, 0.0, 0.3, 0.1], ['燃煤','燃氣','燃油','再生能源','核能','抽蓄','儲能'], '億度')).render();
                    new ApexCharts(document.querySelector("#evolution-area"), {
                        series: [{ name: '燃煤', data: [45.4, 46.3, 45.0, 44.8, 42.1, 39.3] }, { name: '燃氣', data: [31.5, 34.6, 35.7, 37.2, 38.8, 42.4] }, { name: '再生能源', data: [4.8, 4.9, 5.4, 6.0, 8.6, 11.6] }, { name: '核能', data: [12.0, 9.3, 11.2, 9.6, 8.2, 4.7] }],
                        chart: { type: 'area', height: 450, stacked: true, toolbar: { show: false }, fontFamily: 'Noto Sans TC' },
                        xaxis: { categories: ["2016", "2018", "2020", "2021", "2022", "2024實績"], labels: { style: { fontWeight: 700, colors: '#64748b' } } },
                        yaxis: { max: 100, labels: { formatter: (v) => v + "%", style: { fontWeight: 700, colors: '#64748b' } } },
                        colors: [THEME.coal, THEME.gas, THEME.re, THEME.nuke],
                        fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.75, opacityTo: 0.9 } },
                        stroke: { width: 2.5, curve: 'smooth' },
                        legend: { position: 'top', horizontalAlign: 'right', fontWeight: 800 }
                    }).render();
                    
                    const loader = document.getElementById('loader');
                    loader.style.opacity = '0';
                    setTimeout(() => loader.style.display = 'none', 500);
                } catch (e) { console.error("系統渲染中斷，請重整預覽:", e); }
            }, 400);
        });
    </script>
</body>
</html>


<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2050 èƒ½æºè·¯å¾‘èˆ‡ä¾›éœ€æ¨ä¼°æ¨¡å‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .card { background: white; border-radius: 1rem; border: 1px solid #e2e8f0; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        input[type="number"] { font-family: ui-monospace, monospace; }
        .active-tab { background-color: #3b82f6 !important; color: white !important; }
        .chart-container { position: relative; width: 100%; }
        /* è‡ªå®šç¾©æ»¾å‹•æ¢æ¨£å¼ï¼Œè®“è¡Œå‹•è£ç½®é«”é©—æ›´å¥½ */
        .overflow-x-auto::-webkit-scrollbar { height: 4px; }
        .overflow-x-auto::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="p-3 md:p-8 text-slate-800">
    <div class="max-w-[1400px] mx-auto">
        <!-- Header -->
        <header class="mb-6 md:mb-8 text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-slate-900 tracking-tight px-2">2050 èƒ½æºè½‰å‹è·¯å¾‘æ¨ä¼°å·¥å…·</h1>
            <p class="text-slate-500 mt-2 text-xs md:text-base px-4">æ•¸æ“šåŸºç¤ï¼š2024å¹´åº•å¯¦ç¸¾ | æœªä¾†è¦åŠƒï¼šä¾æ“šæä¾›ä¹‹é›»æºä¾›çµ¦è¦åŠƒèˆ‡èƒ½æºæ”¿ç­–æ–¹å‘</p>
            
            <!-- Data Management Buttons (Responsive layout) -->
            <div class="mt-6 flex flex-wrap justify-center gap-2 md:gap-3 px-4">
                <button onclick="exportSettings()" class="flex items-center gap-2 px-3 py-2 bg-slate-800 text-white rounded-lg text-xs md:text-sm font-semibold hover:bg-slate-700 transition-all shadow-sm">
                    <svg class="w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    åŒ¯å‡ºè¨­å®š
                </button>
                <button onclick="document.getElementById('importFile').click()" class="flex items-center gap-2 px-3 py-2 bg-white text-slate-800 border border-slate-200 rounded-lg text-xs md:text-sm font-semibold hover:bg-slate-50 transition-all shadow-sm">
                    <svg class="w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    åŒ¯å…¥è¨­å®š
                </button>
                <input type="file" id="importFile" accept=".json" onchange="importSettings(event)" class="hidden">
            </div>
        </header>

        <div class="grid grid-cols-1 xl:grid-cols-12 gap-4 md:gap-8">
            <!-- Left: Inputs -->
            <div class="xl:col-span-7 space-y-4">
                
                <!-- Demand Side (Compact & Responsive) -->
                <div class="card p-4 border-t-4 border-t-orange-500">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3 gap-2">
                        <h2 class="text-sm md:text-md font-bold flex items-center gap-2">
                            <span class="text-orange-500">ğŸ¢</span> éœ€æ±‚ç«¯ï¼šç”¨é›»æˆé•·è¨­å®š
                        </h2>
                        <span class="text-[10px] font-medium text-slate-400 bg-slate-100 px-2 py-0.5 rounded">åŸºæœŸ (2024): 282 TWh</span>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center gap-3 bg-orange-50 p-3 rounded-lg">
                        <div class="flex-1 w-full flex items-center gap-3">
                            <span class="text-[10px] md:text-[11px] font-bold text-orange-800 whitespace-nowrap">å¹´å‡æˆé•·ç‡</span>
                            <input type="range" id="growthRange" min="0" max="5" step="0.1" value="2.5" oninput="syncGrowth(this.value)" class="w-full accent-orange-600">
                        </div>
                        <div class="flex items-center gap-2 border-t sm:border-t-0 sm:border-l border-orange-200 pt-2 sm:pt-0 sm:pl-4 w-full sm:w-auto justify-center">
                            <input type="number" id="growthRate" value="2.5" step="0.1" oninput="syncGrowth(this.value)" class="w-16 border border-orange-200 rounded p-1 text-center text-sm font-bold text-orange-600 focus:border-orange-500 outline-none">
                            <span class="text-xs font-bold text-orange-800">%</span>
                        </div>
                    </div>
                </div>

                <!-- Supply Side Table -->
                <div class="card p-4 md:p-6 border-t-4 border-t-blue-500">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4">
                        <h2 class="text-md md:text-lg font-bold flex items-center gap-2">
                            <span class="text-blue-500">âš¡</span> ä¾›çµ¦ç«¯ï¼šå„éšæ®µè£ç½®å®¹é‡ (GW)
                        </h2>
                        <button onclick="addRow()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-lg text-xs md:text-sm transition-all flex items-center gap-1 shadow-sm">
                            <span>+</span> æ–°å¢èƒ½æº
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto -mx-1 px-1">
                        <table class="w-full text-left border-collapse min-w-[600px]" id="energyTable">
                            <thead>
                                <tr class="text-slate-400 text-[10px] uppercase tracking-widest border-b border-slate-100">
                                    <th class="pb-3 font-semibold pr-2">èƒ½æºé¡åˆ¥</th>
                                    <th class="pb-3 font-semibold text-center w-16 px-1">CF(%)</th>
                                    <th class="pb-3 font-semibold text-center px-1 bg-blue-50/50 rounded-t-lg">2026</th>
                                    <th class="pb-3 font-semibold text-center px-1 bg-blue-50/50">2030</th>
                                    <th class="pb-3 font-semibold text-center px-1 bg-blue-50/50">2035</th>
                                    <th class="pb-3 font-semibold text-center px-1 bg-blue-50/50 rounded-t-lg">2050</th>
                                    <th class="pb-3 w-8"></th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-slate-50 text-[12px] md:text-[13px]">
                                <!-- Rows populate from JS -->
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3 block md:hidden text-[10px] text-slate-400 text-center italic">
                        â¬… å·¦å³æ»‘å‹•è¡¨æ ¼å¯ç·¨è¼¯å„å¹´ä»½æ•¸æ“š â¡
                    </div>
                </div>
            </div>

            <!-- Right: Analysis Charts -->
            <div class="xl:col-span-5 space-y-6">
                <!-- Chart 1: Trend Bar -->
                <div class="card p-4 md:p-6">
                    <h2 class="text-md md:text-lg font-bold text-slate-700 mb-6 flex justify-between items-center">
                        ä¾›éœ€å¹³è¡¡è·¯å¾‘ (TWh)
                        <span class="text-[9px] md:text-[10px] font-normal text-slate-400 border border-slate-200 px-2 py-1 rounded">2026 - 2050</span>
                    </h2>
                    <div class="chart-container h-64 md:h-80">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <!-- Chart 2: Mix Doughnut with Tabs -->
                <div class="card p-4 md:p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
                        <h2 class="text-md md:text-lg font-bold text-slate-700">ç™¼é›»é…æ¯”åˆ†æ (%)</h2>
                        <div class="flex bg-slate-100 p-1 rounded-lg w-full sm:w-auto">
                            <button onclick="changeMixYear(2026)" class="mix-tab flex-1 active-tab px-2 md:px-3 py-1 rounded-md text-[9px] md:text-[10px] font-bold uppercase transition-all" id="tab2026">2026</button>
                            <button onclick="changeMixYear(2030)" class="mix-tab flex-1 px-2 md:px-3 py-1 rounded-md text-[9px] md:text-[10px] font-bold uppercase transition-all" id="tab2030">2030</button>
                            <button onclick="changeMixYear(2035)" class="mix-tab flex-1 px-2 md:px-3 py-1 rounded-md text-[9px] md:text-[10px] font-bold uppercase transition-all" id="tab2035">2035</button>
                            <button onclick="changeMixYear(2050)" class="mix-tab flex-1 px-2 md:px-3 py-1 rounded-md text-[9px] md:text-[10px] font-bold uppercase transition-all" id="tab2050">2050</button>
                        </div>
                    </div>
                    <div class="chart-container h-80 md:h-96">
                        <canvas id="mixChart"></canvas>
                    </div>
                    <div class="mt-4 pt-4 border-t border-slate-50 text-center">
                        <p class="text-[10px] md:text-xs text-slate-400 font-medium tracking-wide">
                            <span id="displayYearText">2026</span> å¹´åº¦ç¸½ä¾›çµ¦ï¼š<span id="displayYearGen" class="text-blue-600 font-bold">0</span> TWh
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <footer class="mt-12 text-center text-slate-400 text-[10px] md:text-xs py-8 border-t border-slate-200">
            Â© èƒ½æºé…æ¯”è·¯å¾‘æ¨¡æ“¬å·¥å…· | åŸºæœŸï¼š2024 (282 TWh) | åŒ…å«æŠ½è“„æ°´åŠ›èˆ‡å„²èƒ½èª¿åº¦è€ƒé‡
        </footer>
    </div>

    <script>
        // è¨»å†Šæ•¸æ“šæ¨™ç±¤æ’ä»¶
        Chart.register(ChartDataLabels);

        // è‡ªå®šç¾©æ’ä»¶ï¼šåœ¨åœ“é¤…åœ–ä¸­é–“é¡¯ç¤ºæ–‡å­—
        const centerTextPlugin = {
            id: 'centerText',
            afterDraw: (chart) => {
                if (chart.config.type !== 'doughnut') return;
                const { ctx, chartArea: { top, bottom, left, right, width, height } } = chart;
                ctx.save();
                
                const renewablePercent = chart.config.options.renewableValue || 0;
                const centerX = (left + right) / 2;
                const centerY = (top + bottom) / 2;

                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // æ ¹æ“šå®¹å™¨å¯¬åº¦ç¸®æ”¾æ–‡å­—
                const scaleFactor = width < 250 ? 0.8 : 1;

                // ç¬¬ä¸€è¡Œï¼šæ¨™é¡Œ
                ctx.font = `bold ${12 * scaleFactor}px Inter, "Microsoft JhengHei"`;
                ctx.fillStyle = '#64748b';
                ctx.fillText('å†ç”Ÿèƒ½æºä½”æ¯”', centerX, centerY - (12 * scaleFactor));

                // ç¬¬äºŒè¡Œï¼šæ•¸å€¼
                ctx.font = `bold ${24 * scaleFactor}px Inter, "Microsoft JhengHei"`;
                ctx.fillStyle = '#10b981';
                ctx.fillText(renewablePercent + '%', centerX, centerY + (12 * scaleFactor));
                
                ctx.restore();
            }
        };
        Chart.register(centerTextPlugin);

        let trendChart, mixChart;
        let currentMixYear = 2026;
        const baseDemand = 282;
        const targetYears = [2026, 2030, 2035, 2050];
        
        let annualData = {
            2026: { labels: [], gens: [], total: 0, renewableTotal: 0 },
            2030: { labels: [], gens: [], total: 0, renewableTotal: 0 },
            2035: { labels: [], gens: [], total: 0, renewableTotal: 0 },
            2050: { labels: [], gens: [], total: 0, renewableTotal: 0 }
        };

        // é è¨­èƒ½æºè³‡æ–™
        const defaultEnergies = [
            { name: "ç‡ƒæ°£ç™¼é›» (LNG)", cf: 66.58, cap: { 2026: 24.99, 2030: 31.18, 2035: 33.77, 2050: 35.00 } },
            { name: "ç‡ƒç…¤ç™¼é›» (Coal)", cf: 66.82, cap: { 2026: 18.00, 2030: 12.00, 2035: 5.00, 2050: 0.00 } },
            { name: "å¤ªé™½å…‰é›» (PV)", cf: 13.54, cap: { 2026: 18.50, 2030: 30.00, 2035: 50.00, 2050: 80.00 } },
            { name: "é›¢å²¸é¢¨é›»", cf: 38.97, cap: { 2026: 5.60, 2030: 13.10, 2035: 20.00, 2050: 40.00 } },
            { name: "åœ°ç†± (Geothermal)", cf: 43.78, cap: { 2026: 0.50, 2030: 1.20, 2035: 2.00, 2050: 5.00 } },
            { name: "æŠ½è“„æ°´åŠ›", cf: 13.61, cap: { 2026: 2.60, 2030: 2.60, 2035: 3.00, 2050: 4.00 } },
            { name: "å„²èƒ½ (Storage)", cf: 5.00, cap: { 2026: 1.00, 2030: 3.00, 2035: 6.00, 2050: 15.00 } },
            { name: "æ ¸èƒ½", cf: 90.74, cap: { 2026: 0.00, 2030: 0.00, 2035: 0.00, 2050: 0.00 } },
            { name: "æ…£å¸¸æ°´åŠ›", cf: 22.27, cap: { 2026: 2.12, 2030: 2.50, 2035: 3.00, 2050: 4.00 } },
            { name: "å»¢æ£„ç‰©/ç”Ÿè³ªèƒ½", cf: 63.95, cap: { 2026: 0.70, 2030: 1.20, 2035: 2.00, 2050: 5.00 } }
        ];

        function initCharts() {
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(ctxTrend, {
                type: 'bar',
                data: {
                    labels: targetYears.map(y => y + 'å¹´'),
                    datasets: [
                        { label: 'é ä¼°ç¸½ä¾›çµ¦ (TWh)', data: [], backgroundColor: '#3b82f6', borderRadius: 4 },
                        { label: 'é ä¼°ç¸½éœ€æ±‚ (TWh)', data: [], backgroundColor: '#f97316', borderRadius: 4 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: { top: 30 } },
                    scales: { 
                        y: { beginAtZero: true, grid: { borderDash: [5, 5], color: '#e2e8f0' } },
                        x: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 10, weight: '600' } } },
                        datalabels: {
                            anchor: 'end', align: 'top', color: '#475569',
                            font: { size: 9, weight: 'bold' },
                            formatter: (value) => Math.round(value)
                        },
                        centerText: false
                    }
                }
            });

            const ctxMix = document.getElementById('mixChart').getContext('2d');
            mixChart = new Chart(ctxMix, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: ['#3b82f6', '#64748b', '#fbbf24', '#06b6d4', '#10b981', '#6366f1', '#f43f5e', '#f59e0b', '#14b8a6', '#8b5cf6', '#a855f7'],
                        borderWidth: 2, borderColor: '#ffffff', hoverOffset: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: { padding: 40 },
                    renewableValue: 0,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: true },
                        datalabels: {
                            color: '#334155', anchor: 'end', align: 'end', offset: 8,
                            font: { size: 9, weight: '600' },
                            display: (context) => context.dataset.data[context.dataIndex] > 2 ? 'auto' : false,
                            formatter: (value, context) => {
                                const label = context.chart.data.labels[context.dataIndex];
                                // è¡Œå‹•è£ç½®ä¸Šç²¾ç°¡æ¨™ç±¤
                                if (context.chart.width < 350) return `${value}%`;
                                return `${label}\n${value}%`;
                            },
                            textAlign: 'center', padding: 4
                        }
                    },
                    cutout: '70%'
                }
            });
        }

        function isRenewable(name) {
            const keywords = ['å¤ªé™½', 'é¢¨', 'æ°´', 'å»¢æ£„ç‰©', 'ç”Ÿè³ª', 'åœ°ç†±', 'PV', 'å„²èƒ½'];
            return keywords.some(key => name.includes(key));
        }

        function syncGrowth(val) {
            document.getElementById('growthRange').value = val;
            document.getElementById('growthRate').value = val;
            calculate();
        }

        function changeMixYear(year) {
            currentMixYear = year;
            document.querySelectorAll('.mix-tab').forEach(t => t.classList.remove('active-tab'));
            document.getElementById('tab' + year).classList.add('active-tab');
            updateMixChartDisplay();
        }

        function calculate() {
            const rows = document.querySelectorAll('.energy-row');
            const rate = parseFloat(document.getElementById('growthRate').value) || 0;
            
            targetYears.forEach(y => {
                annualData[y] = { labels: [], gens: [], total: 0, renewableTotal: 0 };
            });

            rows.forEach(row => {
                const nameInput = row.querySelector('.energy-name');
                const name = nameInput ? nameInput.value : "æœªçŸ¥";
                const cfInput = row.querySelector('.cf-input');
                const cf = cfInput ? parseFloat(cfInput.value) || 0 : 0;

                targetYears.forEach(year => {
                    const capInput = row.querySelector('.cap-' + year);
                    const cap = capInput ? parseFloat(capInput.value) || 0 : 0;
                    const gen = (cap * 8760 * (cf / 100)) / 1000;
                    
                    annualData[year].labels.push(name);
                    annualData[year].gens.push(gen);
                    annualData[year].total += gen;
                    if (isRenewable(name)) {
                        annualData[year].renewableTotal += gen;
                    }
                });
            });

            const demandPoints = targetYears.map(year => {
                return baseDemand * Math.pow(1 + (rate / 100), year - 2024);
            });

            trendChart.data.datasets[0].data = targetYears.map(y => annualData[y].total);
            trendChart.data.datasets[1].data = demandPoints;
            trendChart.update();

            updateMixChartDisplay();
        }

        function updateMixChartDisplay() {
            const data = annualData[currentMixYear];
            const percentages = data.gens.map(g => data.total > 0 ? parseFloat(((g / data.total) * 100).toFixed(1)) : 0);
            const renewablePercent = data.total > 0 ? ((data.renewableTotal / data.total) * 100).toFixed(1) : 0;
            
            mixChart.data.labels = data.labels;
            mixChart.data.datasets[0].data = percentages;
            mixChart.options.renewableValue = renewablePercent;
            mixChart.update();

            document.getElementById('displayYearText').innerText = currentMixYear;
            document.getElementById('displayYearGen').innerText = data.total.toFixed(1);
        }

        function addRow(data = null) {
            const tbody = document.querySelector('#energyTable tbody');
            const newRow = document.createElement('tr');
            newRow.className = 'energy-row';
            
            const name = data ? data.name : "æ–°èƒ½æºé …ç›®";
            const cf = data ? data.cf : 30.00;
            const caps = data ? data.cap : { 2026: 1.00, 2030: 2.00, 2035: 3.00, 2050: 5.00 };

            newRow.innerHTML = `
                <td class="py-2 pr-2 font-semibold text-slate-700 min-w-[120px]">
                    <input type="text" value="${name}" class="energy-name bg-transparent border-none p-0 w-full outline-none focus:text-blue-600 transition-colors text-[12px] md:text-[13px]">
                </td>
                <td class="px-1"><input type="number" value="${cf}" step="0.01" oninput="calculate()" class="cf-input w-12 md:w-full text-center bg-transparent outline-none border-b border-transparent focus:border-blue-200"></td>
                <td class="px-1"><input type="number" value="${caps[2026]}" step="0.01" oninput="calculate()" class="cap-2026 w-12 md:w-full text-center border rounded p-0.5"></td>
                <td class="px-1"><input type="number" value="${caps[2030]}" step="0.01" oninput="calculate()" class="cap-2030 w-12 md:w-full text-center border rounded p-0.5"></td>
                <td class="px-1"><input type="number" value="${caps[2035]}" step="0.01" oninput="calculate()" class="cap-2035 w-12 md:w-full text-center border rounded p-0.5"></td>
                <td class="px-1"><input type="number" value="${caps[2050]}" step="0.01" oninput="calculate()" class="cap-2050 w-12 md:w-full text-center border rounded p-0.5 font-bold"></td>
                <td class="text-right"><button onclick="deleteRow(this)" class="text-slate-300 hover:text-red-500 transition-colors px-1">âœ•</button></td>
            `;
            tbody.appendChild(newRow);
            calculate();
        }

        function deleteRow(btn) {
            btn.closest('tr').remove();
            calculate();
        }

        // Export/Import Functions
        function exportSettings() {
            const rows = document.querySelectorAll('.energy-row');
            const exportData = {
                growthRate: parseFloat(document.getElementById('growthRate').value),
                energies: []
            };

            rows.forEach(row => {
                exportData.energies.push({
                    name: row.querySelector('.energy-name').value,
                    cf: parseFloat(row.querySelector('.cf-input').value),
                    cap: {
                        2026: parseFloat(row.querySelector('.cap-2026').value),
                        2030: parseFloat(row.querySelector('.cap-2030').value),
                        2035: parseFloat(row.querySelector('.cap-2035').value),
                        2050: parseFloat(row.querySelector('.cap-2050').value)
                    }
                });
            });

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `energy_mix_projection_${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importSettings(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData.growthRate !== undefined) syncGrowth(importedData.growthRate);
                    if (importedData.energies && Array.isArray(importedData.energies)) {
                        const tbody = document.querySelector('#energyTable tbody');
                        tbody.innerHTML = '';
                        importedData.energies.forEach(energy => addRow(energy));
                    }
                    calculate();
                } catch (err) {
                    alert('åŒ¯å…¥æª”æ¡ˆæ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºä¿æª”æ¡ˆæ˜¯ç”±æ­¤å·¥å…·å°å‡ºçš„ JSON æª”æ¡ˆã€‚');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        window.onload = function() {
            initCharts();
            defaultEnergies.forEach(energy => addRow(energy));
        };
    </script>
</body>
</html>
